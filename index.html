<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Filament Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #4ECDC4;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4ECDC4;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }
        
        .btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            border: 1px solid #e0e6ed;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }
        
        table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e0e6ed;
            font-size: 14px;
        }
        
        table tr:hover {
            background: #f8f9fa;
        }
        
        .status-low {
            background: #ffebee;
            color: #c62828;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .status-medium {
            background: #fff3e0;
            color: #ef6c00;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .status-high {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .status-progress {
            background: #d1ecf1;
            color: #0c5460;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .status-done {
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .status-delivered {
            background: #e2e3e5;
            color: #383d41;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .url-link {
            color: #4ECDC4;
            text-decoration: none;
            font-weight: 600;
        }

        .url-link:hover {
            text-decoration: underline;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e0e6ed;
            transition: transform 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4ECDC4;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-weight: 600;
        }
        
        .download-section {
            text-align: center;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 10px;
        }
        
        .download-btn {
            background: white;
            color: #667eea;
            font-size: 18px;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 10px;
            text-decoration: none;
            display: inline-block;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .action-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .action-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ 3D Filament Tracker</h1>
            <p>Track your filament inventory and project usage with precision</p>
        </div>
        
        <div class="main-content">
            <!-- Statistics Section -->
            <div class="section">
                <h2>üìä Inventory Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalSpools">0</div>
                        <div class="stat-label">Total Spools</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalWeight">0g</div>
                        <div class="stat-label">Total Weight</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalProjects">0</div>
                        <div class="stat-label">Projects</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="lowStockCount">0</div>
                        <div class="stat-label">Low Stock</div>
                    </div>
                </div>
            </div>

            <!-- Add Filament Section -->
            <div class="section">
                <h2>‚ûï Add New Filament Spool</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="filamentBrand">Brand</label>
                        <input type="text" id="filamentBrand" placeholder="e.g., Hatchbox, eSUN">
                    </div>
                    <div class="form-group">
                        <label for="filamentType">Material Type</label>
                        <select id="filamentType">
                            <option value="PLA">PLA</option>
                            <option value="ABS">ABS</option>
                            <option value="PETG">PETG</option>
                            <option value="TPU">TPU</option>
                            <option value="Wood">Wood Fill</option>
                            <option value="Metal">Metal Fill</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filamentColor">Color</label>
                        <input type="text" id="filamentColor" placeholder="e.g., Red, Blue, Transparent">
                    </div>
                    <div class="form-group">
                        <label for="filamentWeight">Initial Weight (grams)</label>
                        <input type="number" id="filamentWeight" placeholder="1000" min="1">
                    </div>
                    <div class="form-group">
                        <label for="filamentCost">Cost (‚Çπ)</label>
                        <input type="number" id="filamentCost" placeholder="2000.00" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="purchaseDate">Purchase Date</label>
                        <input type="date" id="purchaseDate">
                    </div>
                </div>
                <button class="btn" onclick="addFilament()">Add Filament Spool</button>
            </div>

            <!-- Filament Inventory Table -->
            <div class="section">
                <h2>üì¶ Filament Inventory</h2>
                <div class="table-container">
                    <table id="filamentTable">
                        <thead>
                            <tr>
                                <th>Brand</th>
                                <th>Type</th>
                                <th>Color</th>
                                <th>Original Weight</th>
                                <th>Current Weight</th>
                                <th>Used</th>
                                <th>Cost</th>
                                <th>Purchase Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="filamentTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Project Usage Section -->
            <div class="section">
                <h2>üî® Record Project Usage</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="customerName">Customer Name</label>
                        <input type="text" id="customerName" placeholder="John Doe, Personal Project, etc.">
                    </div>
                    <div class="form-group">
                        <label for="projectName">Project Name</label>
                        <input type="text" id="projectName" placeholder="e.g., Phone Stand, Miniature">
                    </div>
                    <div class="form-group">
                        <label for="projectUrl">Project URL (Optional)</label>
                        <input type="url" id="projectUrl" placeholder="https://thingiverse.com/thing/...">
                    </div>
                    <div class="form-group">
                        <label for="projectFilament">Select Filament</label>
                        <select id="projectFilament">
                            <option value="">Choose filament...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="usedWeight">Weight Used (grams)</label>
                        <input type="number" id="usedWeight" placeholder="15" min="0.1" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="projectStatus">Project Status</label>
                        <select id="projectStatus">
                            <option value="Pending">üîÑ Pending</option>
                            <option value="In Progress">‚öôÔ∏è In Progress</option>
                            <option value="Done">‚úÖ Done</option>
                            <option value="Delivered">üì¶ Delivered</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="projectDate">Project Date</label>
                        <input type="date" id="projectDate">
                    </div>
                    <div class="form-group">
                        <label for="projectNotes">Notes (Optional)</label>
                        <input type="text" id="projectNotes" placeholder="Print settings, issues, etc.">
                    </div>
                </div>
                <button class="btn" onclick="addProject()">Record Project Usage</button>
            </div>

            <!-- Project History Table -->
            <div class="section">
                <h2>üìã Project History</h2>
                <div class="table-container">
                    <table id="projectTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Project Name</th>
                                <th>Customer</th>
                                <th>Filament Used</th>
                                <th>Weight Used</th>
                                <th>Cost</th>
                                <th>Status</th>
                                <th>URL</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="projectTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Download Section -->
            <div class="download-section">
                <h2>üíæ Export Your Data</h2>
                <p>Download your filament tracking data as CSV files for backup or use in Excel/Google Sheets</p>
                <br>
                <a href="#" class="download-btn" onclick="downloadFilamentCSV()">üìä Download Filament Inventory</a>
                <a href="#" class="download-btn" onclick="downloadProjectCSV()">üìã Download Project History</a>
            </div>
        </div>
    </div>

    <script>
        let filaments = [];
        let projects = [];

        // Load data from localStorage on page load
        window.onload = function() {
            loadData();
            updateFilamentDropdown();
            updateTables();
            updateStats();
            
            // Set today's date as default
            document.getElementById('purchaseDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('projectDate').value = new Date().toISOString().split('T')[0];
        };

        function loadData() {
            const savedFilaments = localStorage.getItem('filamentTracker_filaments');
            const savedProjects = localStorage.getItem('filamentTracker_projects');
            
            if (savedFilaments) {
                filaments = JSON.parse(savedFilaments);
            }
            if (savedProjects) {
                projects = JSON.parse(savedProjects);
            }
        }

        function saveData() {
            localStorage.setItem('filamentTracker_filaments', JSON.stringify(filaments));
            localStorage.setItem('filamentTracker_projects', JSON.stringify(projects));
        }

        function addFilament() {
            const brand = document.getElementById('filamentBrand').value;
            const type = document.getElementById('filamentType').value;
            const color = document.getElementById('filamentColor').value;
            const weight = parseFloat(document.getElementById('filamentWeight').value);
            const cost = parseFloat(document.getElementById('filamentCost').value) || 0;
            const purchaseDate = document.getElementById('purchaseDate').value;

            if (!brand || !color || !weight || !purchaseDate) {
                alert('Please fill in all required fields');
                return;
            }

            const filament = {
                id: Date.now(),
                brand,
                type,
                color,
                originalWeight: weight,
                currentWeight: weight,
                cost,
                purchaseDate
            };

            filaments.push(filament);
            saveData();
            updateFilamentDropdown();
            updateTables();
            updateStats();

            // Clear form
            document.getElementById('filamentBrand').value = '';
            document.getElementById('filamentColor').value = '';
            document.getElementById('filamentWeight').value = '';
            document.getElementById('filamentCost').value = '';
        }

        function addProject() {
            const customerName = document.getElementById('customerName').value;
            const projectName = document.getElementById('projectName').value;
            const projectUrl = document.getElementById('projectUrl').value;
            const filamentId = parseInt(document.getElementById('projectFilament').value);
            const usedWeight = parseFloat(document.getElementById('usedWeight').value);
            const projectStatus = document.getElementById('projectStatus').value;
            const projectDate = document.getElementById('projectDate').value;
            const notes = document.getElementById('projectNotes').value;

            if (!customerName || !projectName || !filamentId || !usedWeight || !projectDate) {
                alert('Please fill in all required fields');
                return;
            }

            const filament = filaments.find(f => f.id === filamentId);
            if (!filament) {
                alert('Selected filament not found');
                return;
            }

            if (usedWeight > filament.currentWeight) {
                alert('Not enough filament remaining. Available: ' + filament.currentWeight + 'g');
                return;
            }

            // Calculate cost per gram for this project
            const costPerGram = filament.cost / filament.originalWeight;
            const projectCost = costPerGram * usedWeight;

            const project = {
                id: Date.now(),
                projectName,
                customerName,
                projectUrl,
                filamentId,
                filamentName: `${filament.brand} ${filament.type} ${filament.color}`,
                usedWeight,
                projectCost,
                projectStatus,
                projectDate,
                notes
            };

            projects.push(project);

            // Update filament current weight
            filament.currentWeight -= usedWeight;

            saveData();
            updateFilamentDropdown();
            updateTables();
            updateStats();

            // Clear form
            document.getElementById('customerName').value = '';
            document.getElementById('projectName').value = '';
            document.getElementById('projectUrl').value = '';
            document.getElementById('projectFilament').value = '';
            document.getElementById('usedWeight').value = '';
            document.getElementById('projectStatus').value = 'Pending';
            document.getElementById('projectNotes').value = '';
        }

        function updateFilamentDropdown() {
            const select = document.getElementById('projectFilament');
            select.innerHTML = '<option value="">Choose filament...</option>';
            
            filaments.forEach(filament => {
                if (filament.currentWeight > 0) {
                    const option = document.createElement('option');
                    option.value = filament.id;
                    option.textContent = `${filament.brand} ${filament.type} ${filament.color} (${filament.currentWeight}g remaining)`;
                    select.appendChild(option);
                }
            });
        }

        function updateTables() {
            updateFilamentTable();
            updateProjectTable();
        }

        function updateFilamentTable() {
            const tbody = document.getElementById('filamentTableBody');
            tbody.innerHTML = '';

            filaments.forEach(filament => {
                const row = document.createElement('tr');
                const usedWeight = filament.originalWeight - filament.currentWeight;
                const usagePercent = (usedWeight / filament.originalWeight) * 100;
                
                let status = 'high';
                let statusText = 'Good';
                if (usagePercent > 80) {
                    status = 'low';
                    statusText = 'Low';
                } else if (usagePercent > 50) {
                    status = 'medium';
                    statusText = 'Medium';
                }

                row.innerHTML = `
                    <td>${filament.brand}</td>
                    <td>${filament.type}</td>
                    <td>${filament.color}</td>
                    <td>${filament.originalWeight}g</td>
                    <td>${filament.currentWeight}g</td>
                    <td>${usedWeight.toFixed(1)}g</td>
                    <td>‚Çπ${filament.cost.toFixed(2)}</td>
                    <td>${filament.purchaseDate}</td>
                    <td><span class="status-${status}">${statusText}</span></td>
                    <td><button class="action-btn" onclick="deleteFilament(${filament.id})">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateProjectTable() {
            const tbody = document.getElementById('projectTableBody');
            tbody.innerHTML = '';

            projects.slice().reverse().forEach(project => {
                const row = document.createElement('tr');
                
                // Get status class
                let statusClass = 'status-pending';
                if (project.projectStatus === 'In Progress') statusClass = 'status-progress';
                else if (project.projectStatus === 'Done') statusClass = 'status-done';
                else if (project.projectStatus === 'Delivered') statusClass = 'status-delivered';
                
                // Format URL display
                const urlDisplay = project.projectUrl ? 
                    `<a href="${project.projectUrl}" class="url-link" target="_blank">üîó View</a>` : 
                    '-';
                
                row.innerHTML = `
                    <td>${project.projectDate}</td>
                    <td>${project.projectName}</td>
                    <td>${project.customerName}</td>
                    <td>${project.filamentName}</td>
                    <td>${project.usedWeight}g</td>
                    <td>‚Çπ${project.projectCost.toFixed(2)}</td>
                    <td><span class="${statusClass}">${project.projectStatus}</span></td>
                    <td>${urlDisplay}</td>
                    <td>${project.notes || '-'}</td>
                    <td><button class="action-btn" onclick="deleteProject(${project.id})">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateStats() {
            document.getElementById('totalSpools').textContent = filaments.length;
            
            const totalWeight = filaments.reduce((sum, f) => sum + f.currentWeight, 0);
            document.getElementById('totalWeight').textContent = totalWeight.toFixed(0) + 'g';
            
            document.getElementById('totalProjects').textContent = projects.length;
            
            const lowStockCount = filaments.filter(f => {
                const usagePercent = ((f.originalWeight - f.currentWeight) / f.originalWeight) * 100;
                return usagePercent > 80;
            }).length;
            document.getElementById('lowStockCount').textContent = lowStockCount;
        }

        function deleteFilament(id) {
            if (confirm('Are you sure you want to delete this filament? This will also remove all associated projects.')) {
                filaments = filaments.filter(f => f.id !== id);
                projects = projects.filter(p => p.filamentId !== id);
                saveData();
                updateFilamentDropdown();
                updateTables();
                updateStats();
            }
        }

        function deleteProject(id) {
            if (confirm('Are you sure you want to delete this project?')) {
                const project = projects.find(p => p.id === id);
                if (project) {
                    // Return the filament weight
                    const filament = filaments.find(f => f.id === project.filamentId);
                    if (filament) {
                        filament.currentWeight += project.usedWeight;
                    }
                }
                projects = projects.filter(p => p.id !== id);
                saveData();
                updateFilamentDropdown();
                updateTables();
                updateStats();
            }
        }

        function downloadFilamentCSV() {
            const headers = ['Brand', 'Type', 'Color', 'Original Weight (g)', 'Current Weight (g)', 'Used Weight (g)', 'Cost (‚Çπ)', 'Purchase Date', 'Status'];
            const rows = filaments.map(f => {
                const usedWeight = f.originalWeight - f.currentWeight;
                const usagePercent = (usedWeight / f.originalWeight) * 100;
                let status = 'Good';
                if (usagePercent > 80) status = 'Low';
                else if (usagePercent > 50) status = 'Medium';
                
                return [f.brand, f.type, f.color, f.originalWeight, f.currentWeight, usedWeight.toFixed(1), f.cost.toFixed(2), f.purchaseDate, status];
            });

            downloadCSV('filament_inventory.csv', [headers, ...rows]);
        }

        function downloadProjectCSV() {
            const headers = ['Date', 'Project Name', 'Customer', 'Filament Used', 'Weight Used (g)', 'Cost (‚Çπ)', 'Status', 'URL', 'Notes'];
            const rows = projects.map(p => [p.projectDate, p.projectName, p.customerName, p.filamentName, p.usedWeight, p.projectCost.toFixed(2), p.projectStatus, p.projectUrl || '', p.notes || '']);

            downloadCSV('project_history.csv', [headers, ...rows]);
        }

        function downloadCSV(filename, data) {
            const csvContent = data.map(row => row.map(field => `"${field}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>